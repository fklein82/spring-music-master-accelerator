#@ load("@ytt:data", "data")

Spring Music
============

This is a sample application for using database services on [Tanzu Application Platform](https://tanzu.vmware.com/application-platform) with the [Spring Framework](http://spring.io) and [Spring Boot](http://projects.spring.io/spring-boot/).

This application has been built to store the same domain objects in one of a variety of different persistence technologies - relational, document, and key-value stores. This is not meant to represent a realistic use case for these technologies, since you would typically choose the one most applicable to the type of data you need to store, but it is useful for testing and experimenting with different types of services on Cloud Foundry.

The application use Spring Java configuration and [bean profiles](http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html) to configure the application and the connection objects needed to use the persistence stores. It also uses the [Java CFEnv](https://github.com/pivotal-cf/java-cfenv/) library to inspect the environment when running on Cloud Foundry. See the [Cloud Foundry documentation](http://docs.cloudfoundry.org/buildpacks/java/spring-service-bindings.html) for details on configuring a Spring application for Cloud Foundry.

## Steps to perform to deploy the application
#@ if data.values.dbType == "Postgresql":

### Deploy the database packaged by VMware Application Catalog
#### Create all the secrets needed for the databse 
~~~
$ kubectl apply -f ./config/postgresql/oss-postgresql/yaml
~~~

#### Deploy the database with the helm chart provided by VMware Application Catalog
~~~
$ helm install -f ./config/helm/helm-values-postgresql.yaml #@ data.values.dbHost oci://registry.cloud-garage.net/library/postgresql
~~~
Please allow some time for the Database to be deployed
#@ end

### Deploy the Tanzu Application Platform workload to use this DB
~~~
$ kubectl apply -f config/workload.yaml
~~~

### Access the tap-gui platform to follow the supply-chain and see the result of the application
